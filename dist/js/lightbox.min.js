"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,i){"function"==typeof define&&define.amd?define(["jquery"],i):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=i(require("jquery")):t.lightbox=i(t.jQuery)}(void 0,function(g){function t(t){this.album=[],this.currentImageIndex=void 0,this.init(),this.options=g.extend({},this.constructor.defaults),this.option(t)}return t.defaults={albumLabel:"Image %1 of %2",alwaysShowNavOnTouchDevices:!1,fadeDuration:600,fitImagesInViewport:!0,imageFadeDuration:600,positionFromTop:50,resizeDuration:700,showImageNumberLabel:!0,wrapAround:!1,disableScrolling:!1,sanitizeTitle:!1},t.prototype.option=function(t){g.extend(this.options,t)},t.prototype.imageCountLabel=function(t,i){return this.options.albumLabel.replace(/%1/g,t).replace(/%2/g,i)},t.prototype.init=function(){var t=this;g(document).ready(function(){t.enable(),t.build()})},t.prototype.enable=function(){var i=this;g("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",function(t){return i.start(g(t.currentTarget)),!1})},t.prototype.build=function(){var i;0<g("#lightbox").length||(i=this,g('<div id="lightboxOverlay" tabindex="-1" class="lightboxOverlay"></div><div id="lightbox" tabindex="-1" class="lightbox"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt=""/><div class="lb-nav"><a class="lb-prev" role="button" tabindex="0" aria-label="Previous image" href="" ></a><a class="lb-next" role="button" tabindex="0" aria-label="Next image" href="" ></a></div><div class="lb-loader"><a class="lb-cancel" role="button" tabindex="0"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close" role="button" tabindex="0"></a></div></div></div></div>').appendTo(g("body")),this.$lightbox=g("#lightbox"),this.$overlay=g("#lightboxOverlay"),this.$outerContainer=this.$lightbox.find(".lb-outerContainer"),this.$container=this.$lightbox.find(".lb-container"),this.$image=this.$lightbox.find(".lb-image"),this.$nav=this.$lightbox.find(".lb-nav"),this.containerPadding={top:parseInt(this.$container.css("padding-top"),10),right:parseInt(this.$container.css("padding-right"),10),bottom:parseInt(this.$container.css("padding-bottom"),10),left:parseInt(this.$container.css("padding-left"),10)},this.imageBorderWidth={top:parseInt(this.$image.css("border-top-width"),10),right:parseInt(this.$image.css("border-right-width"),10),bottom:parseInt(this.$image.css("border-bottom-width"),10),left:parseInt(this.$image.css("border-left-width"),10)},this.$overlay.hide().on("click",function(){return i.end(),!1}),this.$lightbox.hide().on("click",function(t){"lightbox"===g(t.target).attr("id")&&i.end()}),this.$outerContainer.on("click",function(t){return"lightbox"===g(t.target).attr("id")&&i.end(),!1}),this.$lightbox.find(".lb-prev").on("click",function(){return 0===i.currentImageIndex?i.changeImage(i.album.length-1):i.changeImage(i.currentImageIndex-1),!1}),this.$lightbox.find(".lb-next").on("click",function(){return i.currentImageIndex===i.album.length-1?i.changeImage(0):i.changeImage(i.currentImageIndex+1),!1}),this.$nav.on("mousedown",function(t){3===t.which&&(i.$nav.css("pointer-events","none"),i.$lightbox.one("contextmenu",function(){setTimeout(function(){this.$nav.css("pointer-events","auto")}.bind(i),0)}))}),this.$lightbox.find(".lb-loader, .lb-close").on("click keyup",function(t){if("click"===t.type||"keyup"===t.type&&(13===t.which||32===t.which))return i.end(),!1}))},t.prototype.start=function(t){var i=this,e=g(window),n=(e.on("resize",g.proxy(this.sizeOverlay,this)),this.sizeOverlay(),this.album=[],0);function o(t){i.album.push({alt:t.attr("data-alt"),link:t.attr("href"),title:t.attr("data-title")||t.attr("title")})}var a=t.attr("data-lightbox");if(a)for(var s=g(t.prop("tagName")+'[data-lightbox="'+a+'"]'),r=0;r<s.length;r=++r)o(g(s[r])),s[r]===t[0]&&(n=r);else if("lightbox"===t.attr("rel"))o(t);else{s=g(t.prop("tagName")+'[rel="'+t.attr("rel")+'"]');for(var h=0;h<s.length;h=++h)o(g(s[h])),s[h]===t[0]&&(n=h)}a=e.scrollTop()+this.options.positionFromTop,e=e.scrollLeft();this.$lightbox.css({top:a+"px",left:e+"px"}).fadeIn(this.options.fadeDuration),this.options.disableScrolling&&g("body").addClass("lb-disable-scrolling"),this.changeImage(n)},t.prototype.changeImage=function(a){var s=this,r=this.album[a].link,h=r.split(".").slice(-1)[0],l=this.$lightbox.find(".lb-image"),d=(this.disableKeyboardNav(),this.$overlay.fadeIn(this.options.fadeDuration),g(".lb-loader").fadeIn("slow"),this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide(),this.$outerContainer.addClass("animating"),new Image);d.onload=function(){l.attr({alt:s.album[a].alt,src:r}),g(d),l.width(d.width),l.height(d.height);var t,i,e=d.width/d.height,n=g(window).width(),o=g(window).height(),n=n-s.containerPadding.left-s.containerPadding.right-s.imageBorderWidth.left-s.imageBorderWidth.right-20,o=o-s.containerPadding.top-s.containerPadding.bottom-s.imageBorderWidth.top-s.imageBorderWidth.bottom-s.options.positionFromTop-70;"svg"===h?(t=1<=e?(i=n,parseInt(n/e,10)):(i=parseInt(o/e,10),o),l.width(i),l.height(t)):(s.options.fitImagesInViewport?(s.options.maxWidth&&s.options.maxWidth<n&&(n=s.options.maxWidth),s.options.maxHeight&&s.options.maxHeight<o&&(o=s.options.maxHeight)):(n=s.options.maxWidth||d.width||n,o=s.options.maxHeight||d.height||o),(d.width>n||d.height>o)&&(d.width/n>d.height/o?(i=n,t=parseInt(d.height/(d.width/i),10)):(t=o,i=parseInt(d.width/(d.height/t),10)),l.width(i),l.height(t))),s.sizeContainer(l.width(),l.height())},d.src=this.album[a].link,this.currentImageIndex=a},t.prototype.sizeOverlay=function(){var t=this;setTimeout(function(){t.$overlay.width(g(document).width()).height(g(document).height())},0)},t.prototype.sizeContainer=function(t,i){var e=this,n=this.$outerContainer.outerWidth(),o=this.$outerContainer.outerHeight(),a=t+this.containerPadding.left+this.containerPadding.right+this.imageBorderWidth.left+this.imageBorderWidth.right,s=i+this.containerPadding.top+this.containerPadding.bottom+this.imageBorderWidth.top+this.imageBorderWidth.bottom;function r(){e.$lightbox.find(".lb-dataContainer").width(a),e.$lightbox.find(".lb-prevLink").height(s),e.$lightbox.find(".lb-nextLink").height(s),e.$overlay.trigger("focus"),e.showImage()}n!==a||o!==s?this.$outerContainer.animate({width:a,height:s},this.options.resizeDuration,"swing",function(){r()}):r()},t.prototype.showImage=function(){this.$lightbox.find(".lb-loader").stop(!0).hide(),this.$lightbox.find(".lb-image").fadeIn(this.options.imageFadeDuration),this.updateNav(),this.updateDetails(),this.preloadNeighboringImages(),this.enableKeyboardNav()},t.prototype.updateNav=function(){var t=!1;try{document.createEvent("TouchEvent"),t=!!this.options.alwaysShowNavOnTouchDevices}catch(t){}this.$lightbox.find(".lb-nav").show(),1<this.album.length&&(this.options.wrapAround?(t&&this.$lightbox.find(".lb-prev, .lb-next").css("opacity","1"),this.$lightbox.find(".lb-prev, .lb-next").show()):(0<this.currentImageIndex&&(this.$lightbox.find(".lb-prev").show(),t)&&this.$lightbox.find(".lb-prev").css("opacity","1"),this.currentImageIndex<this.album.length-1&&(this.$lightbox.find(".lb-next").show(),t)&&this.$lightbox.find(".lb-next").css("opacity","1")))},t.prototype.updateDetails=function(){var t,i=this;void 0!==this.album[this.currentImageIndex].title&&""!==this.album[this.currentImageIndex].title&&(t=this.$lightbox.find(".lb-caption"),this.options.sanitizeTitle?t.text(this.album[this.currentImageIndex].title):t.html(this.album[this.currentImageIndex].title),t.fadeIn("fast")),1<this.album.length&&this.options.showImageNumberLabel?(t=this.imageCountLabel(this.currentImageIndex+1,this.album.length),this.$lightbox.find(".lb-number").text(t).fadeIn("fast")):this.$lightbox.find(".lb-number").hide(),this.$outerContainer.removeClass("animating"),this.$lightbox.find(".lb-dataContainer").fadeIn(this.options.resizeDuration,function(){return i.sizeOverlay()})},t.prototype.preloadNeighboringImages=function(){this.album.length>this.currentImageIndex+1&&((new Image).src=this.album[this.currentImageIndex+1].link),0<this.currentImageIndex&&((new Image).src=this.album[this.currentImageIndex-1].link)},t.prototype.enableKeyboardNav=function(){this.$lightbox.on("keyup.keyboard",g.proxy(this.keyboardAction,this)),this.$overlay.on("keyup.keyboard",g.proxy(this.keyboardAction,this))},t.prototype.disableKeyboardNav=function(){this.$lightbox.off(".keyboard"),this.$overlay.off(".keyboard")},t.prototype.keyboardAction=function(t){var i=t.keyCode;27===i?(t.stopPropagation(),this.end()):37===i?0!==this.currentImageIndex?this.changeImage(this.currentImageIndex-1):this.options.wrapAround&&1<this.album.length&&this.changeImage(this.album.length-1):39===i&&(this.currentImageIndex!==this.album.length-1?this.changeImage(this.currentImageIndex+1):this.options.wrapAround&&1<this.album.length&&this.changeImage(0))},t.prototype.end=function(){this.disableKeyboardNav(),g(window).off("resize",this.sizeOverlay),this.$lightbox.fadeOut(this.options.fadeDuration),this.$overlay.fadeOut(this.options.fadeDuration),this.options.disableScrolling&&g("body").removeClass("lb-disable-scrolling")},new t});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpZ2h0Ym94LmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIl90eXBlb2YiLCJtb2R1bGUiLCJyZXF1aXJlIiwialF1ZXJ5IiwiJCIsIkxpZ2h0Ym94Iiwib3B0aW9ucyIsInRoaXMiLCJhbGJ1bSIsImN1cnJlbnRJbWFnZUluZGV4IiwiZXh0ZW5kIiwiY29uc3RydWN0b3IiLCJkZWZhdWx0cyIsIm9wdGlvbiIsImFsYnVtTGFiZWwiLCJhbHdheXNTaG93TmF2T25Ub3VjaERldmljZXMiLCJmYWRlRHVyYXRpb24iLCJwb3NpdGlvbkZyb21Ub3AiLCJyZXNpemVEdXJhdGlvbiIsInNob3dJbWFnZU51bWJlckxhYmVsIiwic2FuaXRpemVUaXRsZSIsInByb3RvdHlwZSIsInJlcGxhY2UiLCJjdXJyZW50SW1hZ2VOdW0iLCJ0b3RhbEltYWdlcyIsImluaXQiLCJkb2N1bWVudCIsInNlbGYiLCJidWlsZCIsInJlYWR5IiwiZW5hYmxlIiwic3RhcnQiLCJvbiIsImV2ZW50IiwiY3VycmVudFRhcmdldCIsImxlbmd0aCIsImFwcGVuZFRvIiwiJGNvbnRhaW5lciIsIiRsaWdodGJveCIsImZpbmQiLCIkaW1hZ2UiLCIkbmF2IiwiY29udGFpbmVyUGFkZGluZyIsImJvdHRvbSIsImxlZnQiLCJwYXJzZUludCIsImNzcyIsInJpZ2h0IiwiaW1hZ2VCb3JkZXJXaWR0aCIsInRvcCIsIiRvdmVybGF5IiwiaGlkZSIsImVuZCIsIiRvdXRlckNvbnRhaW5lciIsInRhcmdldCIsImF0dHIiLCJjaGFuZ2VJbWFnZSIsIndoaWNoIiwidHlwZSIsIm9uZSIsInNldFRpbWVvdXQiLCJiaW5kIiwiJHdpbmRvdyIsInNpemVPdmVybGF5IiwiZSIsImltYWdlTnVtYmVyIiwiYWRkVG9BbGJ1bSIsIiRsaW5rIiwiZGF0YUxpZ2h0Ym94VmFsdWUiLCJwcm94eSIsIiRsaW5rcyIsInB1c2giLCJhbHQiLCJsaW5rIiwicHJvcCIsImkiLCJmYWRlSW4iLCJkaXNhYmxlU2Nyb2xsaW5nIiwiYWRkQ2xhc3MiLCJqIiwic2Nyb2xsTGVmdCIsImRpc2FibGVLZXlib2FyZE5hdiIsInByZWxvYWRlciIsImltYWdlV2lkdGgiLCJtYXhJbWFnZUhlaWdodCIsImZpbGVuYW1lIiwibWF4SW1hZ2VXaWR0aCIsImZpbGV0eXBlIiwid2luZG93SGVpZ2h0Iiwic3BsaXQiLCJzbGljZSIsIndpbmRvd1dpZHRoIiwid2lkdGgiLCJoZWlnaHQiLCJhc3BlY3RSYXRpbyIsIndpbmRvdyIsIkltYWdlIiwib25sb2FkIiwic3JjIiwiZml0SW1hZ2VzSW5WaWV3cG9ydCIsIm1heEhlaWdodCIsImltYWdlSGVpZ2h0IiwibWF4V2lkdGgiLCJzaXplQ29udGFpbmVyIiwibmV3SGVpZ2h0Iiwib2xkV2lkdGgiLCJwb3N0UmVzaXplIiwicHJlbG9hZE5laWdoYm9yaW5nSW1hZ2VzIiwiZW5hYmxlS2V5Ym9hcmROYXYiLCJvdXRlcldpZHRoIiwib2xkSGVpZ2h0Iiwib3V0ZXJIZWlnaHQiLCJhbHdheXNTaG93TmF2IiwibmV3V2lkdGgiLCJjcmVhdGVFdmVudCIsInNob3ciLCJzaG93SW1hZ2UiLCJhbmltYXRlIiwic3RvcCIsImltYWdlRmFkZUR1cmF0aW9uIiwidXBkYXRlTmF2IiwidXBkYXRlRGV0YWlscyIsIiRjYXB0aW9uIiwid3JhcEFyb3VuZCIsInByZWxvYWROZXh0IiwibGFiZWxUZXh0Iiwia2V5Ym9hcmRBY3Rpb24iLCJLRVlDT0RFX0VTQyIsInRpdGxlIiwiS0VZQ09ERV9MRUZUQVJST1ciLCJLRVlDT0RFX1JJR0hUQVJST1ciLCJrZXljb2RlIiwidGV4dCIsImtleUNvZGUiLCJodG1sIiwiZmFkZU91dCIsIm9mZiIsInN0b3BQcm9wYWdhdGlvbiIsInJlbW92ZUNsYXNzIl0sIm1hcHBpbmdzIjoiOFBBWUEsQ0FBQSxTQUFBQSxFQUFBQyxHQUkwQixZQUFsQixPQUFPQyxRQUF5QkEsT0FBT0MsSUFEOUNELE9BQWMsQ0FBQSxVQUFXRCxDQUFBLEVBQ1Us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SCxLQUFLRSxrQkFDUEYsS0FBS2lELFlBQVlqRCxLQUFLRSxrQkFBb0IsQ0FBQyxFQUNsQ0YsS0FBS0QsUUFBUXFILFlBQWtDLEVBQXBCcEgsS0FBS0MsTUFBTTJCLFFBQy9DNUIsS0FBS2lELFlBQVlqRCxLQUFLQyxNQUFNMkIsT0FBUyxDQUFDLEVBWGpCLEtBYWRnRyxJQUNMNUgsS0FBS0Usb0JBQXNCRixLQUFLQyxNQUFNMkIsT0FBUyxFQUNqRDVCLEtBQUtpRCxZQUFZakQsS0FBS0Usa0JBQW9CLENBQUMsRUFDbENGLEtBQUtELFFBQVFxSCxZQUFrQyxFQUFwQnBILEtBQUtDLE1BQU0yQixRQUMvQzVCLEtBQUtpRCxZQUFZLENBQUMsRUFHeEIsRUFHQW5ELEVBQVNnQixVQUFVK0IsSUFBTSxXQUN2QjdDLEtBQUswRSxtQkFBa0IsRUFDdkI3RSxFQUFFMkYsTUFBTSxFQUFFeUMsSUFBSSxTQUFVakksS0FBS3dELFdBQVcsRUFDeEN4RCxLQUFLK0IsVUFBVWlHLFFBQVFoSSxLQUFLRCxRQUFRVSxZQUFZLEVBQ2hEVCxLQUFLMkMsU0FBU3FGLFFBQVFoSSxLQUFLRCxRQUFRVSxZQUFZLEVBRTNDVCxLQUFLRCxRQUFRdUUsa0JBQ2Z6RSxFQUFFLE1BQU0sRUFBRXNJLFlBQVksc0JBQXNCLENBRWhELEVBRU8sSUFBSXJJLENBQ2IsQ0FBQyIsImZpbGUiOiJsaWdodGJveC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIExpZ2h0Ym94IHYyLjExLjRcbiAqIGJ5IExva2VzaCBEaGFrYXJcbiAqXG4gKiBNb3JlIGluZm86XG4gKiBodHRwOi8vbG9rZXNoZGhha2FyLmNvbS9wcm9qZWN0cy9saWdodGJveDIvXG4gKlxuICogQ29weXJpZ2h0IExva2VzaCBEaGFrYXJcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cHM6Ly9naXRodWIuY29tL2xva2VzaC9saWdodGJveDIvYmxvYi9tYXN0ZXIvTElDRU5TRVxuICpcbiAqIEBwcmVzZXJ2ZVxuICovXG5cbi8vIFVzZXMgTm9kZSwgQU1EIG9yIGJyb3dzZXIgZ2xvYmFscyB0byBjcmVhdGUgYSBtb2R1bGUuXG4oZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHtcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS5cbiAgICAgICAgZGVmaW5lKFsnanF1ZXJ5J10sIGZhY3RvcnkpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIC8vIE5vZGUuIERvZXMgbm90IHdvcmsgd2l0aCBzdHJpY3QgQ29tbW9uSlMsIGJ1dFxuICAgICAgICAvLyBvbmx5IENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHRoYXQgc3VwcG9ydCBtb2R1bGUuZXhwb3J0cyxcbiAgICAgICAgLy8gbGlrZSBOb2RlLlxuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnanF1ZXJ5JykpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEJyb3dzZXIgZ2xvYmFscyAocm9vdCBpcyB3aW5kb3cpXG4gICAgICAgIHJvb3QubGlnaHRib3ggPSBmYWN0b3J5KHJvb3QualF1ZXJ5KTtcbiAgICB9XG59KHRoaXMsIGZ1bmN0aW9uICgkKSB7XG5cbiAgZnVuY3Rpb24gTGlnaHRib3gob3B0aW9ucykge1xuICAgIHRoaXMuYWxidW0gPSBbXTtcbiAgICB0aGlzLmN1cnJlbnRJbWFnZUluZGV4ID0gdm9pZCAwO1xuICAgIHRoaXMuaW5pdCgpO1xuXG4gICAgLy8gb3B0aW9uc1xuICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCB0aGlzLmNvbnN0cnVjdG9yLmRlZmF1bHRzKTtcbiAgICB0aGlzLm9wdGlvbihvcHRpb25zKTtcbiAgfVxuXG4gIC8vIERlc2NyaXB0aW9ucyBvZiBhbGwgb3B0aW9ucyBhdmFpbGFibGUgb24gdGhlIGRlbW8gc2l0ZTpcbiAgLy8gaHR0cDovL2xva2VzaGRoYWthci5jb20vcHJvamVjdHMvbGlnaHRib3gyL2luZGV4Lmh0bWwjb3B0aW9uc1xuICBMaWdodGJveC5kZWZhdWx0cyA9IHtcbiAgICBhbGJ1bUxhYmVsOiAnSW1hZ2UgJTEgb2YgJTInLFxuICAgIGFsd2F5c1Nob3dOYXZPblRvdWNoRGV2aWNlczogZmFsc2UsXG4gICAgZmFkZUR1cmF0aW9uOiA2MDAsXG4gICAgZml0SW1hZ2VzSW5WaWV3cG9ydDogdHJ1ZSxcbiAgICBpbWFnZUZhZGVEdXJhdGlvbjogNjAwLFxuICAgIC8vIG1heFdpZHRoOiA4MDAsXG4gICAgLy8gbWF4SGVpZ2h0OiA2MDAsXG4gICAgcG9zaXRpb25Gcm9tVG9wOiA1MCxcbiAgICByZXNpemVEdXJhdGlvbjogNzAwLFxuICAgIHNob3dJbWFnZU51bWJlckxhYmVsOiB0cnVlLFxuICAgIHdyYXBBcm91bmQ6IGZhbHNlLFxuICAgIGRpc2FibGVTY3JvbGxpbmc6IGZhbHNlLFxuICAgIC8qXG4gICAgU2FuaXRpemUgVGl0bGVcbiAgICBJZiB0aGUgY2FwdGlvbiBkYXRhIGlzIHRydXN0ZWQsIGZvciBleGFtcGxlIHlvdSBhcmUgaGFyZGNvZGluZyBpdCBpbiwgdGhlbiBsZWF2ZSB0aGlzIHRvIGZhbHNlLlxuICAgIFRoaXMgd2lsbCBmcmVlIHlvdSB0byBhZGQgaHRtbCB0YWdzLCBzdWNoIGFzIGxpbmtzLCBpbiB0aGUgY2FwdGlvbi5cblxuICAgIElmIHRoZSBjYXB0aW9uIGRhdGEgaXMgdXNlciBzdWJtaXR0ZWQgb3IgZnJvbSBzb21lIG90aGVyIHVudHJ1c3RlZCBzb3VyY2UsIHRoZW4gc2V0IHRoaXMgdG8gdHJ1ZVxuICAgIHRvIHByZXZlbnQgeHNzIGFuZCBvdGhlciBpbmplY3Rpb24gYXR0YWNrcy5cbiAgICAgKi9cbiAgICBzYW5pdGl6ZVRpdGxlOiBmYWxzZVxuICB9O1xuXG4gIExpZ2h0Ym94LnByb3RvdHlwZS5vcHRpb24gPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgJC5leHRlbmQodGhpcy5vcHRpb25zLCBvcHRpb25zKTtcbiAgfTtcblxuICBMaWdodGJveC5wcm90b3R5cGUuaW1hZ2VDb3VudExhYmVsID0gZnVuY3Rpb24oY3VycmVudEltYWdlTnVtLCB0b3RhbEltYWdlcykge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuYWxidW1MYWJlbC5yZXBsYWNlKC8lMS9nLCBjdXJyZW50SW1hZ2VOdW0pLnJlcGxhY2UoLyUyL2csIHRvdGFsSW1hZ2VzKTtcbiAgfTtcblxuICBMaWdodGJveC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAvLyBCb3RoIGVuYWJsZSBhbmQgYnVpbGQgbWV0aG9kcyByZXF1aXJlIHRoZSBib2R5IHRhZyB0byBiZSBpbiB0aGUgRE9NLlxuICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi5lbmFibGUoKTtcbiAgICAgIHNlbGYuYnVpbGQoKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBMb29wIHRocm91Z2ggYW5jaG9ycyBhbmQgYXJlYW1hcHMgbG9va2luZyBmb3IgZWl0aGVyIGRhdGEtbGlnaHRib3ggYXR0cmlidXRlcyBvciByZWwgYXR0cmlidXRlc1xuICAvLyB0aGF0IGNvbnRhaW4gJ2xpZ2h0Ym94Jy4gV2hlbiB0aGVzZSBhcmUgY2xpY2tlZCwgc3RhcnQgbGlnaHRib3guXG4gIExpZ2h0Ym94LnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgJCgnYm9keScpLm9uKCdjbGljaycsICdhW3JlbF49bGlnaHRib3hdLCBhcmVhW3JlbF49bGlnaHRib3hdLCBhW2RhdGEtbGlnaHRib3hdLCBhcmVhW2RhdGEtbGlnaHRib3hdJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIHNlbGYuc3RhcnQoJChldmVudC5jdXJyZW50VGFyZ2V0KSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gQnVpbGQgaHRtbCBmb3IgdGhlIGxpZ2h0Ym94IGFuZCB0aGUgb3ZlcmxheS5cbiAgLy8gQXR0YWNoIGV2ZW50IGhhbmRsZXJzIHRvIHRoZSBuZXcgRE9NIGVsZW1lbnRzLiBjbGljayBjbGljayBjbGlja1xuICBMaWdodGJveC5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoJCgnI2xpZ2h0Ym94JykubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy8gVGhlIHR3byByb290IG5vdGVzIGdlbmVyYXRlZCwgI2xpZ2h0Ym94T3ZlcmxheSBhbmQgI2xpZ2h0Ym94IGFyZSBnaXZlblxuICAgIC8vIHRhYmluZGV4IGF0dHJzIHNvIHRoZXkgYXJlIGZvY3VzYWJsZS4gV2UgYXR0YWNoIG91ciBrZXlib2FyZCBldmVudFxuICAgIC8vIGxpc3RlbmVycyB0byB0aGVzZSB0d28gZWxlbWVudHMsIGFuZCBub3QgdGhlIGRvY3VtZW50LiBDbGlja2luZyBhbnl3aGVyZVxuICAgIC8vIHdoaWxlIExpZ2h0Ym94IGlzIG9wZW5lZCB3aWxsIGtlZXAgdGhlIGZvY3VzIG9uIG9yIGluc2lkZSBvbmUgb2YgdGhlc2VcbiAgICAvLyB0d28gZWxlbWVudHMuXG4gICAgLy9cbiAgICAvLyBXZSBkbyB0aGlzIHNvIHdlIGNhbiBwcmV2ZW50IHByb3BvZ2F0aW9uIG9mIHRoZSBFc2Mga2V5cHJlc3Mgd2hlblxuICAgIC8vIExpZ2h0Ym94IGlzIG9wZW4uIFRoaXMgcHJldmVudHMgaXQgZnJvbSBpbnRlZmVyaW5nIHdpdGggb3RoZXIgY29tcG9uZW50c1xuICAgIC8vIG9uIHRoZSBwYWdlIGJlbG93LlxuICAgIC8vXG4gICAgLy8gR2l0aHViIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vbG9rZXNoL2xpZ2h0Ym94Mi9pc3N1ZXMvNjYzXG4gICAgJCgnPGRpdiBpZD1cImxpZ2h0Ym94T3ZlcmxheVwiIHRhYmluZGV4PVwiLTFcIiBjbGFzcz1cImxpZ2h0Ym94T3ZlcmxheVwiPjwvZGl2PjxkaXYgaWQ9XCJsaWdodGJveFwiIHRhYmluZGV4PVwiLTFcIiBjbGFzcz1cImxpZ2h0Ym94XCI+PGRpdiBjbGFzcz1cImxiLW91dGVyQ29udGFpbmVyXCI+PGRpdiBjbGFzcz1cImxiLWNvbnRhaW5lclwiPjxpbWcgY2xhc3M9XCJsYi1pbWFnZVwiIHNyYz1cImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEFRQUJBSUFBQVAvLy93QUFBQ0g1QkFFQUFBQUFMQUFBQUFBQkFBRUFBQUlDUkFFQU93PT1cIiBhbHQ9XCJcIi8+PGRpdiBjbGFzcz1cImxiLW5hdlwiPjxhIGNsYXNzPVwibGItcHJldlwiIHJvbGU9XCJidXR0b25cIiB0YWJpbmRleD1cIjBcIiBhcmlhLWxhYmVsPVwiUHJldmlvdXMgaW1hZ2VcIiBocmVmPVwiXCIgPjwvYT48YSBjbGFzcz1cImxiLW5leHRcIiByb2xlPVwiYnV0dG9uXCIgdGFiaW5kZXg9XCIwXCIgYXJpYS1sYWJlbD1cIk5leHQgaW1hZ2VcIiBocmVmPVwiXCIgPjwvYT48L2Rpdj48ZGl2IGNsYXNzPVwibGItbG9hZGVyXCI+PGEgY2xhc3M9XCJsYi1jYW5jZWxcIiByb2xlPVwiYnV0dG9uXCIgdGFiaW5kZXg9XCIwXCI+PC9hPjwvZGl2PjwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9XCJsYi1kYXRhQ29udGFpbmVyXCI+PGRpdiBjbGFzcz1cImxiLWRhdGFcIj48ZGl2IGNsYXNzPVwibGItZGV0YWlsc1wiPjxzcGFuIGNsYXNzPVwibGItY2FwdGlvblwiPjwvc3Bhbj48c3BhbiBjbGFzcz1cImxiLW51bWJlclwiPjwvc3Bhbj48L2Rpdj48ZGl2IGNsYXNzPVwibGItY2xvc2VDb250YWluZXJcIj48YSBjbGFzcz1cImxiLWNsb3NlXCIgcm9sZT1cImJ1dHRvblwiIHRhYmluZGV4PVwiMFwiPjwvYT48L2Rpdj48L2Rpdj48L2Rpdj48L2Rpdj4nKS5hcHBlbmRUbygkKCdib2R5JykpO1xuXG4gICAgLy8gQ2FjaGUgalF1ZXJ5IG9iamVjdHNcbiAgICB0aGlzLiRsaWdodGJveCAgICAgICA9ICQoJyNsaWdodGJveCcpO1xuICAgIHRoaXMuJG92ZXJsYXkgICAgICAgID0gJCgnI2xpZ2h0Ym94T3ZlcmxheScpO1xuICAgIHRoaXMuJG91dGVyQ29udGFpbmVyID0gdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW91dGVyQ29udGFpbmVyJyk7XG4gICAgdGhpcy4kY29udGFpbmVyICAgICAgPSB0aGlzLiRsaWdodGJveC5maW5kKCcubGItY29udGFpbmVyJyk7XG4gICAgdGhpcy4kaW1hZ2UgICAgICAgICAgPSB0aGlzLiRsaWdodGJveC5maW5kKCcubGItaW1hZ2UnKTtcbiAgICB0aGlzLiRuYXYgICAgICAgICAgICA9IHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uYXYnKTtcblxuICAgIC8vIFN0b3JlIGNzcyB2YWx1ZXMgZm9yIGZ1dHVyZSBsb29rdXBcbiAgICB0aGlzLmNvbnRhaW5lclBhZGRpbmcgPSB7XG4gICAgICB0b3A6IHBhcnNlSW50KHRoaXMuJGNvbnRhaW5lci5jc3MoJ3BhZGRpbmctdG9wJyksIDEwKSxcbiAgICAgIHJpZ2h0OiBwYXJzZUludCh0aGlzLiRjb250YWluZXIuY3NzKCdwYWRkaW5nLXJpZ2h0JyksIDEwKSxcbiAgICAgIGJvdHRvbTogcGFyc2VJbnQodGhpcy4kY29udGFpbmVyLmNzcygncGFkZGluZy1ib3R0b20nKSwgMTApLFxuICAgICAgbGVmdDogcGFyc2VJbnQodGhpcy4kY29udGFpbmVyLmNzcygncGFkZGluZy1sZWZ0JyksIDEwKVxuICAgIH07XG5cbiAgICB0aGlzLmltYWdlQm9yZGVyV2lkdGggPSB7XG4gICAgICB0b3A6IHBhcnNlSW50KHRoaXMuJGltYWdlLmNzcygnYm9yZGVyLXRvcC13aWR0aCcpLCAxMCksXG4gICAgICByaWdodDogcGFyc2VJbnQodGhpcy4kaW1hZ2UuY3NzKCdib3JkZXItcmlnaHQtd2lkdGgnKSwgMTApLFxuICAgICAgYm90dG9tOiBwYXJzZUludCh0aGlzLiRpbWFnZS5jc3MoJ2JvcmRlci1ib3R0b20td2lkdGgnKSwgMTApLFxuICAgICAgbGVmdDogcGFyc2VJbnQodGhpcy4kaW1hZ2UuY3NzKCdib3JkZXItbGVmdC13aWR0aCcpLCAxMClcbiAgICB9O1xuXG4gICAgLy8gQXR0YWNoIGV2ZW50IGhhbmRsZXJzIHRvIHRoZSBuZXdseSBtaW50ZWQgRE9NIGVsZW1lbnRzXG4gICAgdGhpcy4kb3ZlcmxheS5oaWRlKCkub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLmVuZCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgdGhpcy4kbGlnaHRib3guaGlkZSgpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBpZiAoJChldmVudC50YXJnZXQpLmF0dHIoJ2lkJykgPT09ICdsaWdodGJveCcpIHtcbiAgICAgICAgc2VsZi5lbmQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBpZiAoJChldmVudC50YXJnZXQpLmF0dHIoJ2lkJykgPT09ICdsaWdodGJveCcpIHtcbiAgICAgICAgc2VsZi5lbmQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoc2VsZi5jdXJyZW50SW1hZ2VJbmRleCA9PT0gMCkge1xuICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuYWxidW0ubGVuZ3RoIC0gMSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuY3VycmVudEltYWdlSW5kZXggLSAxKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uZXh0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoc2VsZi5jdXJyZW50SW1hZ2VJbmRleCA9PT0gc2VsZi5hbGJ1bS5sZW5ndGggLSAxKSB7XG4gICAgICAgIHNlbGYuY2hhbmdlSW1hZ2UoMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuY3VycmVudEltYWdlSW5kZXggKyAxKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIC8qXG4gICAgICBTaG93IGNvbnRleHQgbWVudSBmb3IgaW1hZ2Ugb24gcmlnaHQtY2xpY2tcblxuICAgICAgVGhlcmUgaXMgYSBkaXYgY29udGFpbmluZyB0aGUgbmF2aWdhdGlvbiB0aGF0IHNwYW5zIHRoZSBlbnRpcmUgaW1hZ2UgYW5kIGxpdmVzIGFib3ZlIG9mIGl0LiBJZlxuICAgICAgeW91IHJpZ2h0LWNsaWNrLCB5b3UgYXJlIHJpZ2h0IGNsaWNraW5nIHRoaXMgZGl2IGFuZCBub3QgdGhlIGltYWdlLiBUaGlzIHByZXZlbnRzIHVzZXJzIGZyb21cbiAgICAgIHNhdmluZyB0aGUgaW1hZ2Ugb3IgdXNpbmcgb3RoZXIgY29udGV4dCBtZW51IGFjdGlvbnMgd2l0aCB0aGUgaW1hZ2UuXG5cbiAgICAgIFRvIGZpeCB0aGlzLCB3aGVuIHdlIGRldGVjdCB0aGUgcmlnaHQgbW91c2UgYnV0dG9uIGlzIHByZXNzZWQgZG93biwgYnV0IG5vdCB5ZXQgY2xpY2tlZCwgd2VcbiAgICAgIHNldCBwb2ludGVyLWV2ZW50cyB0byBub25lIG9uIHRoZSBuYXYgZGl2LiBUaGlzIGlzIHNvIHRoYXQgdGhlIHVwY29taW5nIHJpZ2h0LWNsaWNrIGV2ZW50IG9uXG4gICAgICB0aGUgbmV4dCBtb3VzZXVwIHdpbGwgYnViYmxlIGRvd24gdG8gdGhlIGltYWdlLiBPbmNlIHRoZSByaWdodC1jbGljay9jb250ZXh0bWVudSBldmVudCBvY2N1cnNcbiAgICAgIHdlIHNldCB0aGUgcG9pbnRlciBldmVudHMgYmFjayB0byBhdXRvIGZvciB0aGUgbmF2IGRpdiBzbyBpdCBjYW4gY2FwdHVyZSBob3ZlciBhbmQgbGVmdC1jbGlja1xuICAgICAgZXZlbnRzIGFzIHVzdWFsLlxuICAgICAqL1xuICAgIHRoaXMuJG5hdi5vbignbW91c2Vkb3duJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIGlmIChldmVudC53aGljaCA9PT0gMykge1xuICAgICAgICBzZWxmLiRuYXYuY3NzKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7XG5cbiAgICAgICAgc2VsZi4kbGlnaHRib3gub25lKCdjb250ZXh0bWVudScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHRoaXMuJG5hdi5jc3MoJ3BvaW50ZXItZXZlbnRzJywgJ2F1dG8nKTtcbiAgICAgICAgICB9LmJpbmQoc2VsZiksIDApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuXG4gICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWxvYWRlciwgLmxiLWNsb3NlJykub24oJ2NsaWNrIGtleXVwJywgZnVuY3Rpb24oZSkge1xuICAgICAgLy8gSWYgbW91c2UgY2xpY2sgT1IgJ2VudGVyJyBvciAnc3BhY2UnIGtleXByZXNzLCBjbG9zZSBMQlxuICAgICAgaWYgKFxuICAgICAgICBlLnR5cGUgPT09ICdjbGljaycgfHwgKGUudHlwZSA9PT0gJ2tleXVwJyAmJiAoZS53aGljaCA9PT0gMTMgfHwgZS53aGljaCA9PT0gMzIpKSkge1xuICAgICAgICBzZWxmLmVuZCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gU2hvdyBvdmVybGF5IGFuZCBsaWdodGJveC4gSWYgdGhlIGltYWdlIGlzIHBhcnQgb2YgYSBzZXQsIGFkZCBzaWJsaW5ncyB0byBhbGJ1bSBhcnJheS5cbiAgTGlnaHRib3gucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24oJGxpbmspIHtcbiAgICB2YXIgc2VsZiAgICA9IHRoaXM7XG4gICAgdmFyICR3aW5kb3cgPSAkKHdpbmRvdyk7XG5cbiAgICAkd2luZG93Lm9uKCdyZXNpemUnLCAkLnByb3h5KHRoaXMuc2l6ZU92ZXJsYXksIHRoaXMpKTtcblxuICAgIHRoaXMuc2l6ZU92ZXJsYXkoKTtcblxuICAgIHRoaXMuYWxidW0gPSBbXTtcbiAgICB2YXIgaW1hZ2VOdW1iZXIgPSAwO1xuXG4gICAgZnVuY3Rpb24gYWRkVG9BbGJ1bSgkbGluaykge1xuICAgICAgc2VsZi5hbGJ1bS5wdXNoKHtcbiAgICAgICAgYWx0OiAkbGluay5hdHRyKCdkYXRhLWFsdCcpLFxuICAgICAgICBsaW5rOiAkbGluay5hdHRyKCdocmVmJyksXG4gICAgICAgIHRpdGxlOiAkbGluay5hdHRyKCdkYXRhLXRpdGxlJykgfHwgJGxpbmsuYXR0cigndGl0bGUnKVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gU3VwcG9ydCBib3RoIGRhdGEtbGlnaHRib3ggYXR0cmlidXRlIGFuZCByZWwgYXR0cmlidXRlIGltcGxlbWVudGF0aW9uc1xuICAgIHZhciBkYXRhTGlnaHRib3hWYWx1ZSA9ICRsaW5rLmF0dHIoJ2RhdGEtbGlnaHRib3gnKTtcbiAgICB2YXIgJGxpbmtzO1xuXG4gICAgaWYgKGRhdGFMaWdodGJveFZhbHVlKSB7XG4gICAgICAkbGlua3MgPSAkKCRsaW5rLnByb3AoJ3RhZ05hbWUnKSArICdbZGF0YS1saWdodGJveD1cIicgKyBkYXRhTGlnaHRib3hWYWx1ZSArICdcIl0nKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJGxpbmtzLmxlbmd0aDsgaSA9ICsraSkge1xuICAgICAgICBhZGRUb0FsYnVtKCQoJGxpbmtzW2ldKSk7XG4gICAgICAgIGlmICgkbGlua3NbaV0gPT09ICRsaW5rWzBdKSB7XG4gICAgICAgICAgaW1hZ2VOdW1iZXIgPSBpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICgkbGluay5hdHRyKCdyZWwnKSA9PT0gJ2xpZ2h0Ym94Jykge1xuICAgICAgICAvLyBJZiBpbWFnZSBpcyBub3QgcGFydCBvZiBhIHNldFxuICAgICAgICBhZGRUb0FsYnVtKCRsaW5rKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIGltYWdlIGlzIHBhcnQgb2YgYSBzZXRcbiAgICAgICAgJGxpbmtzID0gJCgkbGluay5wcm9wKCd0YWdOYW1lJykgKyAnW3JlbD1cIicgKyAkbGluay5hdHRyKCdyZWwnKSArICdcIl0nKTtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAkbGlua3MubGVuZ3RoOyBqID0gKytqKSB7XG4gICAgICAgICAgYWRkVG9BbGJ1bSgkKCRsaW5rc1tqXSkpO1xuICAgICAgICAgIGlmICgkbGlua3Nbal0gPT09ICRsaW5rWzBdKSB7XG4gICAgICAgICAgICBpbWFnZU51bWJlciA9IGo7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUG9zaXRpb24gTGlnaHRib3hcbiAgICB2YXIgdG9wICA9ICR3aW5kb3cuc2Nyb2xsVG9wKCkgKyB0aGlzLm9wdGlvbnMucG9zaXRpb25Gcm9tVG9wO1xuICAgIHZhciBsZWZ0ID0gJHdpbmRvdy5zY3JvbGxMZWZ0KCk7XG4gICAgdGhpcy4kbGlnaHRib3guY3NzKHtcbiAgICAgIHRvcDogdG9wICsgJ3B4JyxcbiAgICAgIGxlZnQ6IGxlZnQgKyAncHgnXG4gICAgfSkuZmFkZUluKHRoaXMub3B0aW9ucy5mYWRlRHVyYXRpb24pO1xuXG4gICAgLy8gRGlzYWJsZSBzY3JvbGxpbmcgb2YgdGhlIHBhZ2Ugd2hpbGUgb3BlblxuICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzYWJsZVNjcm9sbGluZykge1xuICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdsYi1kaXNhYmxlLXNjcm9sbGluZycpO1xuICAgIH1cblxuICAgIHRoaXMuY2hhbmdlSW1hZ2UoaW1hZ2VOdW1iZXIpO1xuICB9O1xuXG4gIC8vIEhpZGUgbW9zdCBVSSBlbGVtZW50cyBpbiBwcmVwYXJhdGlvbiBmb3IgdGhlIGFuaW1hdGVkIHJlc2l6aW5nIG9mIHRoZSBsaWdodGJveC5cbiAgTGlnaHRib3gucHJvdG90eXBlLmNoYW5nZUltYWdlID0gZnVuY3Rpb24oaW1hZ2VOdW1iZXIpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGZpbGVuYW1lID0gdGhpcy5hbGJ1bVtpbWFnZU51bWJlcl0ubGluaztcbiAgICB2YXIgZmlsZXR5cGUgPSBmaWxlbmFtZS5zcGxpdCgnLicpLnNsaWNlKC0xKVswXTtcbiAgICB2YXIgJGltYWdlID0gdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWltYWdlJyk7XG5cbiAgICAvLyBEaXNhYmxlIGtleWJvYXJkIG5hdiBkdXJpbmcgdHJhbnNpdGlvbnNcbiAgICB0aGlzLmRpc2FibGVLZXlib2FyZE5hdigpO1xuXG4gICAgLy8gU2hvdyBsb2FkaW5nIHN0YXRlXG4gICAgdGhpcy4kb3ZlcmxheS5mYWRlSW4odGhpcy5vcHRpb25zLmZhZGVEdXJhdGlvbik7XG4gICAgJCgnLmxiLWxvYWRlcicpLmZhZGVJbignc2xvdycpO1xuICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1pbWFnZSwgLmxiLW5hdiwgLmxiLXByZXYsIC5sYi1uZXh0LCAubGItZGF0YUNvbnRhaW5lciwgLmxiLW51bWJlcnMsIC5sYi1jYXB0aW9uJykuaGlkZSgpO1xuICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLmFkZENsYXNzKCdhbmltYXRpbmcnKTtcblxuICAgIC8vIFdoZW4gaW1hZ2UgdG8gc2hvdyBpcyBwcmVsb2FkZWQsIHdlIHNlbmQgdGhlIHdpZHRoIGFuZCBoZWlnaHQgdG8gc2l6ZUNvbnRhaW5lcigpXG4gICAgdmFyIHByZWxvYWRlciA9IG5ldyBJbWFnZSgpO1xuICAgIHByZWxvYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciAkcHJlbG9hZGVyO1xuICAgICAgdmFyIGltYWdlSGVpZ2h0O1xuICAgICAgdmFyIGltYWdlV2lkdGg7XG4gICAgICB2YXIgbWF4SW1hZ2VIZWlnaHQ7XG4gICAgICB2YXIgbWF4SW1hZ2VXaWR0aDtcbiAgICAgIHZhciB3aW5kb3dIZWlnaHQ7XG4gICAgICB2YXIgd2luZG93V2lkdGg7XG5cbiAgICAgICRpbWFnZS5hdHRyKHtcbiAgICAgICAgJ2FsdCc6IHNlbGYuYWxidW1baW1hZ2VOdW1iZXJdLmFsdCxcbiAgICAgICAgJ3NyYyc6IGZpbGVuYW1lXG4gICAgICB9KTtcblxuICAgICAgJHByZWxvYWRlciA9ICQocHJlbG9hZGVyKTtcblxuICAgICAgJGltYWdlLndpZHRoKHByZWxvYWRlci53aWR0aCk7XG4gICAgICAkaW1hZ2UuaGVpZ2h0KHByZWxvYWRlci5oZWlnaHQpO1xuXG4gICAgICB2YXIgYXNwZWN0UmF0aW8gPSBwcmVsb2FkZXIud2lkdGggLyBwcmVsb2FkZXIuaGVpZ2h0O1xuXG4gICAgICB3aW5kb3dXaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xuICAgICAgd2luZG93SGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgdGhlIG1heCBpbWFnZSBkaW1lbnNpb25zIGZvciB0aGUgY3VycmVudCB2aWV3cG9ydC5cbiAgICAgIC8vIFRha2UgaW50byBhY2NvdW50IHRoZSBib3JkZXIgYXJvdW5kIHRoZSBpbWFnZSBhbmQgYW4gYWRkaXRpb25hbCAxMHB4IGd1dHRlciBvbiBlYWNoIHNpZGUuXG4gICAgICBtYXhJbWFnZVdpZHRoICA9IHdpbmRvd1dpZHRoIC0gc2VsZi5jb250YWluZXJQYWRkaW5nLmxlZnQgLSBzZWxmLmNvbnRhaW5lclBhZGRpbmcucmlnaHQgLSBzZWxmLmltYWdlQm9yZGVyV2lkdGgubGVmdCAtIHNlbGYuaW1hZ2VCb3JkZXJXaWR0aC5yaWdodCAtIDIwO1xuICAgICAgbWF4SW1hZ2VIZWlnaHQgPSB3aW5kb3dIZWlnaHQgLSBzZWxmLmNvbnRhaW5lclBhZGRpbmcudG9wIC0gc2VsZi5jb250YWluZXJQYWRkaW5nLmJvdHRvbSAtIHNlbGYuaW1hZ2VCb3JkZXJXaWR0aC50b3AgLSBzZWxmLmltYWdlQm9yZGVyV2lkdGguYm90dG9tIC0gc2VsZi5vcHRpb25zLnBvc2l0aW9uRnJvbVRvcCAtIDcwO1xuXG4gICAgICAvKlxuICAgICAgU2luY2UgbWFueSBTVkdzIGhhdmUgc21hbGwgaW50cmluc2ljIGRpbWVuc2lvbnMsIGJ1dCB0aGV5IHN1cHBvcnQgc2NhbGluZ1xuICAgICAgdXAgd2l0aG91dCBxdWFsaXR5IGxvc3MgYmVjYXVzZSBvZiB0aGVpciB2ZWN0b3IgZm9ybWF0LCBtYXggb3V0IHRoZWlyXG4gICAgICBzaXplIGluc2lkZSB0aGUgdmlld3BvcnQuXG4gICAgICAqL1xuICAgICAgaWYgKGZpbGV0eXBlID09PSAnc3ZnJykge1xuICAgICAgICBpZiAoYXNwZWN0UmF0aW8gPj0gMSkge1xuICAgICAgICAgIGltYWdlV2lkdGggPSBtYXhJbWFnZVdpZHRoO1xuICAgICAgICAgIGltYWdlSGVpZ2h0ID0gcGFyc2VJbnQobWF4SW1hZ2VXaWR0aCAvIGFzcGVjdFJhdGlvLCAxMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW1hZ2VXaWR0aCA9IHBhcnNlSW50KG1heEltYWdlSGVpZ2h0IC8gYXNwZWN0UmF0aW8sIDEwKTtcbiAgICAgICAgICBpbWFnZUhlaWdodCA9IG1heEltYWdlSGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgICRpbWFnZS53aWR0aChpbWFnZVdpZHRoKTtcbiAgICAgICAgJGltYWdlLmhlaWdodChpbWFnZUhlaWdodCk7XG5cbiAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgLy8gRml0IGltYWdlIGluc2lkZSB0aGUgdmlld3BvcnQuXG4gICAgICAgIGlmIChzZWxmLm9wdGlvbnMuZml0SW1hZ2VzSW5WaWV3cG9ydCkge1xuXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgaW1hZ2Ugc2l6ZSBpcyBsYXJnZXIgdGhlbiBtYXhXaWR0aHxtYXhIZWlnaHQgaW4gc2V0dGluZ3NcbiAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLm1heFdpZHRoICYmIHNlbGYub3B0aW9ucy5tYXhXaWR0aCA8IG1heEltYWdlV2lkdGgpIHtcbiAgICAgICAgICAgIG1heEltYWdlV2lkdGggPSBzZWxmLm9wdGlvbnMubWF4V2lkdGg7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMubWF4SGVpZ2h0ICYmIHNlbGYub3B0aW9ucy5tYXhIZWlnaHQgPCBtYXhJbWFnZUhlaWdodCkge1xuICAgICAgICAgICAgbWF4SW1hZ2VIZWlnaHQgPSBzZWxmLm9wdGlvbnMubWF4SGVpZ2h0O1xuICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1heEltYWdlV2lkdGggPSBzZWxmLm9wdGlvbnMubWF4V2lkdGggfHwgcHJlbG9hZGVyLndpZHRoIHx8IG1heEltYWdlV2lkdGg7XG4gICAgICAgICAgbWF4SW1hZ2VIZWlnaHQgPSBzZWxmLm9wdGlvbnMubWF4SGVpZ2h0IHx8IHByZWxvYWRlci5oZWlnaHQgfHwgbWF4SW1hZ2VIZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJcyB0aGUgY3VycmVudCBpbWFnZSdzIHdpZHRoIG9yIGhlaWdodCBpcyBncmVhdGVyIHRoYW4gdGhlIG1heEltYWdlV2lkdGggb3IgbWF4SW1hZ2VIZWlnaHRcbiAgICAgICAgLy8gb3B0aW9uIHRoYW4gd2UgbmVlZCB0byBzaXplIGRvd24gd2hpbGUgbWFpbnRhaW5pbmcgdGhlIGFzcGVjdCByYXRpby5cbiAgICAgICAgaWYgKChwcmVsb2FkZXIud2lkdGggPiBtYXhJbWFnZVdpZHRoKSB8fCAocHJlbG9hZGVyLmhlaWdodCA+IG1heEltYWdlSGVpZ2h0KSkge1xuICAgICAgICAgIGlmICgocHJlbG9hZGVyLndpZHRoIC8gbWF4SW1hZ2VXaWR0aCkgPiAocHJlbG9hZGVyLmhlaWdodCAvIG1heEltYWdlSGVpZ2h0KSkge1xuICAgICAgICAgICAgaW1hZ2VXaWR0aCAgPSBtYXhJbWFnZVdpZHRoO1xuICAgICAgICAgICAgaW1hZ2VIZWlnaHQgPSBwYXJzZUludChwcmVsb2FkZXIuaGVpZ2h0IC8gKHByZWxvYWRlci53aWR0aCAvIGltYWdlV2lkdGgpLCAxMCk7XG4gICAgICAgICAgICAkaW1hZ2Uud2lkdGgoaW1hZ2VXaWR0aCk7XG4gICAgICAgICAgICAkaW1hZ2UuaGVpZ2h0KGltYWdlSGVpZ2h0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW1hZ2VIZWlnaHQgPSBtYXhJbWFnZUhlaWdodDtcbiAgICAgICAgICAgIGltYWdlV2lkdGggPSBwYXJzZUludChwcmVsb2FkZXIud2lkdGggLyAocHJlbG9hZGVyLmhlaWdodCAvIGltYWdlSGVpZ2h0KSwgMTApO1xuICAgICAgICAgICAgJGltYWdlLndpZHRoKGltYWdlV2lkdGgpO1xuICAgICAgICAgICAgJGltYWdlLmhlaWdodChpbWFnZUhlaWdodCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHNlbGYuc2l6ZUNvbnRhaW5lcigkaW1hZ2Uud2lkdGgoKSwgJGltYWdlLmhlaWdodCgpKTtcbiAgICB9O1xuXG4gICAgLy8gUHJlbG9hZCBpbWFnZSBiZWZvcmUgc2hvd2luZ1xuICAgIHByZWxvYWRlci5zcmMgPSB0aGlzLmFsYnVtW2ltYWdlTnVtYmVyXS5saW5rO1xuICAgIHRoaXMuY3VycmVudEltYWdlSW5kZXggPSBpbWFnZU51bWJlcjtcbiAgfTtcblxuICAvLyBTdHJldGNoIG92ZXJsYXkgdG8gZml0IHRoZSB2aWV3cG9ydFxuICBMaWdodGJveC5wcm90b3R5cGUuc2l6ZU92ZXJsYXkgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgLypcbiAgICBXZSB1c2UgYSBzZXRUaW1lb3V0IDAgdG8gcGF1c2UgSlMgZXhlY3V0aW9uIGFuZCBsZXQgdGhlIHJlbmRlcmluZyBjYXRjaC11cC5cbiAgICBXaHkgZG8gdGhpcz8gSWYgdGhlIGBkaXNhYmxlU2Nyb2xsaW5nYCBvcHRpb24gaXMgc2V0IHRvIHRydWUsIGEgY2xhc3MgaXMgYWRkZWQgdG8gdGhlIGJvZHlcbiAgICB0YWcgdGhhdCBkaXNhYmxlcyBzY3JvbGxpbmcgYW5kIGhpZGVzIHRoZSBzY3JvbGxiYXIuIFdlIHdhbnQgdG8gbWFrZSBzdXJlIHRoZSBzY3JvbGxiYXIgaXNcbiAgICBoaWRkZW4gYmVmb3JlIHdlIG1lYXN1cmUgdGhlIGRvY3VtZW50IHdpZHRoLCBhcyB0aGUgcHJlc2VuY2Ugb2YgdGhlIHNjcm9sbGJhciB3aWxsIGFmZmVjdCB0aGVcbiAgICBudW1iZXIuXG4gICAgKi9cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi4kb3ZlcmxheVxuICAgICAgICAud2lkdGgoJChkb2N1bWVudCkud2lkdGgoKSlcbiAgICAgICAgLmhlaWdodCgkKGRvY3VtZW50KS5oZWlnaHQoKSk7XG5cbiAgICB9LCAwKTtcbiAgfTtcblxuICAvLyBBbmltYXRlIHRoZSBzaXplIG9mIHRoZSBsaWdodGJveCB0byBmaXQgdGhlIGltYWdlIHdlIGFyZSBzaG93aW5nXG4gIC8vIFRoaXMgbWV0aG9kIGFsc28gc2hvd3MgdGhlIHRoZSBpbWFnZS5cbiAgTGlnaHRib3gucHJvdG90eXBlLnNpemVDb250YWluZXIgPSBmdW5jdGlvbihpbWFnZVdpZHRoLCBpbWFnZUhlaWdodCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciBvbGRXaWR0aCAgPSB0aGlzLiRvdXRlckNvbnRhaW5lci5vdXRlcldpZHRoKCk7XG4gICAgdmFyIG9sZEhlaWdodCA9IHRoaXMuJG91dGVyQ29udGFpbmVyLm91dGVySGVpZ2h0KCk7XG4gICAgdmFyIG5ld1dpZHRoICA9IGltYWdlV2lkdGggKyB0aGlzLmNvbnRhaW5lclBhZGRpbmcubGVmdCArIHRoaXMuY29udGFpbmVyUGFkZGluZy5yaWdodCArIHRoaXMuaW1hZ2VCb3JkZXJXaWR0aC5sZWZ0ICsgdGhpcy5pbWFnZUJvcmRlcldpZHRoLnJpZ2h0O1xuICAgIHZhciBuZXdIZWlnaHQgPSBpbWFnZUhlaWdodCArIHRoaXMuY29udGFpbmVyUGFkZGluZy50b3AgKyB0aGlzLmNvbnRhaW5lclBhZGRpbmcuYm90dG9tICsgdGhpcy5pbWFnZUJvcmRlcldpZHRoLnRvcCArIHRoaXMuaW1hZ2VCb3JkZXJXaWR0aC5ib3R0b207XG5cbiAgICBmdW5jdGlvbiBwb3N0UmVzaXplKCkge1xuICAgICAgc2VsZi4kbGlnaHRib3guZmluZCgnLmxiLWRhdGFDb250YWluZXInKS53aWR0aChuZXdXaWR0aCk7XG4gICAgICBzZWxmLiRsaWdodGJveC5maW5kKCcubGItcHJldkxpbmsnKS5oZWlnaHQobmV3SGVpZ2h0KTtcbiAgICAgIHNlbGYuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uZXh0TGluaycpLmhlaWdodChuZXdIZWlnaHQpO1xuXG4gICAgICAvLyBTZXQgZm9jdXMgb24gb25lIG9mIHRoZSB0d28gcm9vdCBub2RlcyBzbyBrZXlib2FyZCBldmVudHMgYXJlIGNhcHR1cmVkLlxuICAgICAgc2VsZi4kb3ZlcmxheS50cmlnZ2VyKCdmb2N1cycpO1xuXG4gICAgICBzZWxmLnNob3dJbWFnZSgpO1xuICAgIH1cblxuICAgIGlmIChvbGRXaWR0aCAhPT0gbmV3V2lkdGggfHwgb2xkSGVpZ2h0ICE9PSBuZXdIZWlnaHQpIHtcbiAgICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLmFuaW1hdGUoe1xuICAgICAgICB3aWR0aDogbmV3V2lkdGgsXG4gICAgICAgIGhlaWdodDogbmV3SGVpZ2h0XG4gICAgICB9LCB0aGlzLm9wdGlvbnMucmVzaXplRHVyYXRpb24sICdzd2luZycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBwb3N0UmVzaXplKCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcG9zdFJlc2l6ZSgpO1xuICAgIH1cbiAgfTtcblxuICAvLyBEaXNwbGF5IHRoZSBpbWFnZSBhbmQgaXRzIGRldGFpbHMgYW5kIGJlZ2luIHByZWxvYWQgbmVpZ2hib3JpbmcgaW1hZ2VzLlxuICBMaWdodGJveC5wcm90b3R5cGUuc2hvd0ltYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWxvYWRlcicpLnN0b3AodHJ1ZSkuaGlkZSgpO1xuICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1pbWFnZScpLmZhZGVJbih0aGlzLm9wdGlvbnMuaW1hZ2VGYWRlRHVyYXRpb24pO1xuXG4gICAgdGhpcy51cGRhdGVOYXYoKTtcbiAgICB0aGlzLnVwZGF0ZURldGFpbHMoKTtcbiAgICB0aGlzLnByZWxvYWROZWlnaGJvcmluZ0ltYWdlcygpO1xuICAgIHRoaXMuZW5hYmxlS2V5Ym9hcmROYXYoKTtcbiAgfTtcblxuICAvLyBEaXNwbGF5IHByZXZpb3VzIGFuZCBuZXh0IG5hdmlnYXRpb24gaWYgYXBwcm9wcmlhdGUuXG4gIExpZ2h0Ym94LnByb3RvdHlwZS51cGRhdGVOYXYgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgdG91Y2ggZXZlbnRzLiBJZiBzbywgd2UgdGFrZSB0aGUgY29uc2VydmF0aXZlIGFwcHJvYWNoXG4gICAgLy8gYW5kIGFzc3VtZSB0aGF0IG1vdXNlIGhvdmVyIGV2ZW50cyBhcmUgbm90IHN1cHBvcnRlZCBhbmQgYWx3YXlzIHNob3cgcHJldi9uZXh0IG5hdmlnYXRpb25cbiAgICAvLyBhcnJvd3MgaW4gaW1hZ2Ugc2V0cy5cbiAgICB2YXIgYWx3YXlzU2hvd05hdiA9IGZhbHNlO1xuICAgIHRyeSB7XG4gICAgICBkb2N1bWVudC5jcmVhdGVFdmVudCgnVG91Y2hFdmVudCcpO1xuICAgICAgYWx3YXlzU2hvd05hdiA9ICh0aGlzLm9wdGlvbnMuYWx3YXlzU2hvd05hdk9uVG91Y2hEZXZpY2VzKSA/IHRydWUgOiBmYWxzZTtcbiAgICB9IGNhdGNoIChlKSB7fVxuXG4gICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW5hdicpLnNob3coKTtcblxuICAgIGlmICh0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCkge1xuICAgICAgICBpZiAoYWx3YXlzU2hvd05hdikge1xuICAgICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2LCAubGItbmV4dCcpLmNzcygnb3BhY2l0eScsICcxJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYsIC5sYi1uZXh0Jykuc2hvdygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEltYWdlSW5kZXggPiAwKSB7XG4gICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYnKS5zaG93KCk7XG4gICAgICAgICAgaWYgKGFsd2F5c1Nob3dOYXYpIHtcbiAgICAgICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2JykuY3NzKCdvcGFjaXR5JywgJzEnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEltYWdlSW5kZXggPCB0aGlzLmFsYnVtLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItbmV4dCcpLnNob3coKTtcbiAgICAgICAgICBpZiAoYWx3YXlzU2hvd05hdikge1xuICAgICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW5leHQnKS5jc3MoJ29wYWNpdHknLCAnMScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvLyBEaXNwbGF5IGNhcHRpb24sIGltYWdlIG51bWJlciwgYW5kIGNsb3NpbmcgYnV0dG9uLlxuICBMaWdodGJveC5wcm90b3R5cGUudXBkYXRlRGV0YWlscyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vIEVuYWJsZSBhbmNob3IgY2xpY2tzIGluIHRoZSBpbmplY3RlZCBjYXB0aW9uIGh0bWwuXG4gICAgLy8gVGhhbmtzIE5hdGUgV3JpZ2h0IGZvciB0aGUgZml4LiBAaHR0cHM6Ly9naXRodWIuY29tL05hdGVXclxuICAgIGlmICh0eXBlb2YgdGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4XS50aXRsZSAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgIHRoaXMuYWxidW1bdGhpcy5jdXJyZW50SW1hZ2VJbmRleF0udGl0bGUgIT09ICcnKSB7XG4gICAgICB2YXIgJGNhcHRpb24gPSB0aGlzLiRsaWdodGJveC5maW5kKCcubGItY2FwdGlvbicpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zYW5pdGl6ZVRpdGxlKSB7XG4gICAgICAgICRjYXB0aW9uLnRleHQodGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4XS50aXRsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkY2FwdGlvbi5odG1sKHRoaXMuYWxidW1bdGhpcy5jdXJyZW50SW1hZ2VJbmRleF0udGl0bGUpO1xuICAgICAgfVxuICAgICAgJGNhcHRpb24uZmFkZUluKCdmYXN0Jyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYWxidW0ubGVuZ3RoID4gMSAmJiB0aGlzLm9wdGlvbnMuc2hvd0ltYWdlTnVtYmVyTGFiZWwpIHtcbiAgICAgIHZhciBsYWJlbFRleHQgPSB0aGlzLmltYWdlQ291bnRMYWJlbCh0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICsgMSwgdGhpcy5hbGJ1bS5sZW5ndGgpO1xuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW51bWJlcicpLnRleHQobGFiZWxUZXh0KS5mYWRlSW4oJ2Zhc3QnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW51bWJlcicpLmhpZGUoKTtcbiAgICB9XG5cbiAgICB0aGlzLiRvdXRlckNvbnRhaW5lci5yZW1vdmVDbGFzcygnYW5pbWF0aW5nJyk7XG5cbiAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItZGF0YUNvbnRhaW5lcicpLmZhZGVJbih0aGlzLm9wdGlvbnMucmVzaXplRHVyYXRpb24sIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHNlbGYuc2l6ZU92ZXJsYXkoKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBQcmVsb2FkIHByZXZpb3VzIGFuZCBuZXh0IGltYWdlcyBpbiBzZXQuXG4gIExpZ2h0Ym94LnByb3RvdHlwZS5wcmVsb2FkTmVpZ2hib3JpbmdJbWFnZXMgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5hbGJ1bS5sZW5ndGggPiB0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICsgMSkge1xuICAgICAgdmFyIHByZWxvYWROZXh0ID0gbmV3IEltYWdlKCk7XG4gICAgICBwcmVsb2FkTmV4dC5zcmMgPSB0aGlzLmFsYnVtW3RoaXMuY3VycmVudEltYWdlSW5kZXggKyAxXS5saW5rO1xuICAgIH1cbiAgICBpZiAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCA+IDApIHtcbiAgICAgIHZhciBwcmVsb2FkUHJldiA9IG5ldyBJbWFnZSgpO1xuICAgICAgcHJlbG9hZFByZXYuc3JjID0gdGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4IC0gMV0ubGluaztcbiAgICB9XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmVuYWJsZUtleWJvYXJkTmF2ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kbGlnaHRib3gub24oJ2tleXVwLmtleWJvYXJkJywgJC5wcm94eSh0aGlzLmtleWJvYXJkQWN0aW9uLCB0aGlzKSk7XG4gICAgdGhpcy4kb3ZlcmxheS5vbigna2V5dXAua2V5Ym9hcmQnLCAkLnByb3h5KHRoaXMua2V5Ym9hcmRBY3Rpb24sIHRoaXMpKTtcbiAgfTtcblxuICBMaWdodGJveC5wcm90b3R5cGUuZGlzYWJsZUtleWJvYXJkTmF2ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kbGlnaHRib3gub2ZmKCcua2V5Ym9hcmQnKTtcbiAgICB0aGlzLiRvdmVybGF5Lm9mZignLmtleWJvYXJkJyk7XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmtleWJvYXJkQWN0aW9uID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgS0VZQ09ERV9FU0MgICAgICAgID0gMjc7XG4gICAgdmFyIEtFWUNPREVfTEVGVEFSUk9XICA9IDM3O1xuICAgIHZhciBLRVlDT0RFX1JJR0hUQVJST1cgPSAzOTtcblxuICAgIHZhciBrZXljb2RlID0gZXZlbnQua2V5Q29kZTtcbiAgICBpZiAoa2V5Y29kZSA9PT0gS0VZQ09ERV9FU0MpIHtcbiAgICAgIC8vIFByZXZlbnQgYnViYmxpbmcgc28gYXMgdG8gbm90IGFmZmVjdCBvdGhlciBjb21wb25lbnRzIG9uIHRoZSBwYWdlLlxuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmVuZCgpO1xuICAgIH0gZWxzZSBpZiAoa2V5Y29kZSA9PT0gS0VZQ09ERV9MRUZUQVJST1cpIHtcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICE9PSAwKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UodGhpcy5jdXJyZW50SW1hZ2VJbmRleCAtIDEpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCAmJiB0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VJbWFnZSh0aGlzLmFsYnVtLmxlbmd0aCAtIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoa2V5Y29kZSA9PT0gS0VZQ09ERV9SSUdIVEFSUk9XKSB7XG4gICAgICBpZiAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCAhPT0gdGhpcy5hbGJ1bS5sZW5ndGggLSAxKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UodGhpcy5jdXJyZW50SW1hZ2VJbmRleCArIDEpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCAmJiB0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VJbWFnZSgwKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLy8gQ2xvc2luZyB0aW1lLiA6LShcbiAgTGlnaHRib3gucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZGlzYWJsZUtleWJvYXJkTmF2KCk7XG4gICAgJCh3aW5kb3cpLm9mZigncmVzaXplJywgdGhpcy5zaXplT3ZlcmxheSk7XG4gICAgdGhpcy4kbGlnaHRib3guZmFkZU91dCh0aGlzLm9wdGlvbnMuZmFkZUR1cmF0aW9uKTtcbiAgICB0aGlzLiRvdmVybGF5LmZhZGVPdXQodGhpcy5vcHRpb25zLmZhZGVEdXJhdGlvbik7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmRpc2FibGVTY3JvbGxpbmcpIHtcbiAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnbGItZGlzYWJsZS1zY3JvbGxpbmcnKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIG5ldyBMaWdodGJveCgpO1xufSkpO1xuIl19
